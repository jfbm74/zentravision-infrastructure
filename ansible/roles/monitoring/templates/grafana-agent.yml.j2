---
server:
  log_level: info

metrics:
  global:
    scrape_interval: 15s
    external_labels:
      environment: {{ app_environment | default(environment) }}
      instance: {{ inventory_hostname }}
      project: zentravision
      
  configs:
  - name: zentravision-metrics
    
    remote_write:
    - url: {{ vault_grafana_prometheus_url }}
      basic_auth:
        username: {{ vault_grafana_username }}
        password: {{ vault_grafana_password }}
      queue_config:
        max_samples_per_send: 1000
        max_shards: 10
        capacity: 10000
      
    scrape_configs:
    - job_name: 'node'
      static_configs:
      - targets: ['localhost:{{ node_exporter_port }}']
        labels:
          service: 'system'
          app: 'zentravision'
          
    - job_name: 'postgresql'
      static_configs:
      - targets: ['localhost:{{ postgres_exporter_port }}']
        labels:
          service: 'postgresql'
          app: 'zentravision'
              
    - job_name: 'redis'
      static_configs:
      - targets: ['localhost:{{ redis_exporter_port }}']
        labels:
          service: 'redis'
          app: 'zentravision'

    - job_name: 'nginx'
      static_configs:
      - targets: ['localhost:{{ nginx_exporter_port }}']
        labels:
          service: 'nginx'
          app: 'zentravision'
              
    - job_name: 'django'
      static_configs:
      - targets: ['localhost:8000']
        labels:
          service: 'django'
          app: 'zentravision'
      metrics_path: '/metrics/'
      scrape_interval: 30s
      
    - job_name: 'grafana-agent'
      static_configs:
      - targets: ['localhost:{{ grafana_agent_port }}']
        labels:
          service: 'grafana-agent'
          app: 'zentravision'