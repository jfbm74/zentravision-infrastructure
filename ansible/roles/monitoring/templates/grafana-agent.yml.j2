---
server:
  log_level: info

metrics:
  global:
    scrape_interval: 15s
    external_labels:
      environment: {{ app_environment }}
      instance: {{ gcp_project_id }}-{{ app_environment }}
      project: {{ gcp_project_id }}
      
  configs:
  - name: {{ gcp_project_id }}-metrics
    
    remote_write:
    - url: {{ vault_grafana_prometheus_url }}
      basic_auth:
        username: {{ vault_grafana_username }}
        password: "{{ grafana_api_token_value }}"
      queue_config:
        max_samples_per_send: 1000
        max_shards: 10
        capacity: 10000
      
    scrape_configs:
    - job_name: 'node'
      static_configs:
      - targets: ['localhost:9100']
        labels:
          service: 'system'
          app: 'zentravision'
          
    - job_name: 'postgresql'
      static_configs:
      - targets: ['localhost:9187']
        labels:
          service: 'postgresql'
          app: 'zentravision'
              
    - job_name: 'redis'
      static_configs:
      - targets: ['localhost:9121']
        labels:
          service: 'redis'
          app: 'zentravision'
              
    - job_name: 'django'
      static_configs:
      - targets: ['localhost:8000']
        labels:
          service: 'django'
          app: 'zentravision'
      metrics_path: '/metrics/'
      scrape_interval: 30s
      
    - job_name: 'grafana-agent'
      static_configs:
      - targets: ['localhost:12345']
        labels:
          service: 'grafana-agent'
          app: 'zentravision'