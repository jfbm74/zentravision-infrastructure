# ============================================================================
# ARCHIVO: ansible/roles/django-monolith/templates/celery_config.py.j2
# Configuraci√≥n adicional para Celery
# ============================================================================

# Celery Configuration for {{ app_name }}
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

# Broker settings
broker_url = 'redis://localhost:6379/0'
result_backend = 'redis://localhost:6379/0'

# Task settings
task_serializer = 'json'
accept_content = ['json']
result_serializer = 'json'
timezone = 'America/Bogota'
enable_utc = True

# Worker settings
worker_prefetch_multiplier = 1
worker_max_tasks_per_child = 1000
worker_disable_rate_limits = True

# Task routing
task_routes = {
    'apps.extractor.tasks.*': {'queue': 'default'},
}

# Task time limits
task_soft_time_limit = {{ celery_soft_time_limit | default(270) }}
task_time_limit = {{ celery_time_limit | default(300) }}

# Result settings
result_expires = 3600

# Logging
worker_log_format = '[%(asctime)s: %(levelname)s/%(processName)s] %(message)s'
worker_task_log_format = '[%(asctime)s: %(levelname)s/%(processName)s][%(task_name)s(%(task_id)s)] %(message)s'

